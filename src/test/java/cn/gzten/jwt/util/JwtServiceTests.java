package cn.gzten.jwt.util;

import cn.gzten.jwt.service.JwtService;
import cn.gzten.util.JsonUtil;
import com.fasterxml.jackson.core.JsonProcessingException;
import org.junit.jupiter.api.Test;

import java.util.logging.Logger;

import static org.junit.jupiter.api.Assertions.assertTrue;

public class JwtServiceTests {
    private static final Logger log = Logger.getLogger(JwtServiceTests.class.getName());

    String publicKeyBase64 = "MIIDSzCCAjOgAwIBAgIELvW1rDANBgkqhkiG9w0BAQsFADBWMQswCQYDVQQGEwJISzEMMAoGA1UECBMDVEtPMQwwCgYDVQQHEwNUS08xKzApBgNVBAMTIkNvbnN1bWVyIE9VPVByaXZhdGUgQmFua2luZyBPPUhTQkMwHhcNMTgwODA4MTMxMTE4WhcNMTgxMTA2MTMxMTE4WjBWMQswCQYDVQQGEwJISzEMMAoGA1UECBMDVEtPMQwwCgYDVQQHEwNUS08xKzApBgNVBAMTIkNvbnN1bWVyIE9VPVByaXZhdGUgQmFua2luZyBPPUhTQkMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDKDUA1UQ3gl24q8Lz3LuubvjoqTvUfXXbnQH0dXTiZw4KefM9O8ocXukkNdCjFJYDlEhbjM3rXduhB1ZDuCfsxCU12i6qkD2NEBl45bbgtL0wcay6bFNcl/stbZVZt1tqWQJ8aEDv9zfZaUgTseNmNcdr0Z29sN2zno8pxn/rRgC41ZUtyjcqMjsl2VdbqaFD72OueGk5Rr1ZEHTC5oJsYCPjX0H5xmidBYSn6lPyBjwvVj4ZaufN7QTY8lLe47u9TWNhml5a9mzD3SmLWkkTtSsvy2ADCPXeATKjUoh87mIdtqqVQ1axunWDvqO8MHj1z1jTLsu5QGQ1HwEfsLUttAgMBAAGjITAfMB0GA1UdDgQWBBSz/Lz7dXxFpwB6onuqPGeSYlOzeDANBgkqhkiG9w0BAQsFAAOCAQEAPMfMuQG/0pvt3qJNMy7dNYaokH6GY1P+zmhNOtEXlDy+oFi9xLcNKyFOLnVd2oEplt1nkR5b29VeJNEjlDv4I7ckjjt+8p5wkab5msyJM74tXNh6l85BaFwXG9DQ9tG3Nl72R+RTxYolreTLQV6S2Mv0i9Wfc3FNWpqOPXs2bODiAUFm+itDDcOsn5h+BZYShxvyMQ9McEFExbZwgkl1FIjg6eDZ4QyVh0Hkdg6gfcr9bPRAjYFUdzj4zM2g6hVJH31i4v5D/i8H0WQh8w2yWzyTmk0jz3/r++olCfHTb6n0KSwX1Y7j3x9UqDflURwAoRJKYufOXNUPUO/JMRW9Rg==";
    String privateKeystoreBase64 = "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";
    String keystorePass = "changeit";
    String keyAlias = "my_test_ca";

    @Test
    public void testEncryptAndDecrypt() throws JsonProcessingException {
        var jwtUtils = new JwtService(privateKeystoreBase64, publicKeyBase64, keyAlias, keystorePass);
        var token = jwtUtils.encrypt();
        log.info(token);
        assertTrue(jwtUtils.isValid(token));

        var jwt = jwtUtils.encrypt("Hello");
        log.info(JsonUtil.toString(jwt));
        assertTrue(jwtUtils.isValid(jwt.accessToken()));
    }
}
